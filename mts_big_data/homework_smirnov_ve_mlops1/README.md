# ML Fraud Detection Service

**DISCLAIMER**

Решение было несколько упрощено, так как столкнулся с проблемой, когда контейнер не запускался по команде (без реакции). По совету преподавателя был:

- Исключен маунтинг директорий input и output из логики сервиса
- Заложена в сервис логика, согласно которой достаточно разместить test.csv файл в этой локальной input директории. То есть, например, пусть датасет, который необходимо проскорить моделью, должен быть сразу помещен в директорию. При сборке образа сервис будет сразу подгружать этот файл, скорить его и выгружать результат в директорию output. 
- Логику прослушивания директории тоже была исключена;

Реализована возможность выгрузки не только файла формата sample_submission, но и:

- Отдельного json файла с топ-5 feature importances используемой модели, где key – название фичи, value – значение фичи;
- png/jpg файла с графиком плотности распределения предсказанных моделью скоров

### Запуск сервиса

По загрузке всех файлов с данными в необходимые траектории, можно переходить к запуску сервиса.

**Сборка контейнера:**

`docker build -t mlops_hw1 .`

**Запуск контейнера (стандартно):**

`docker run --rm ` `

**Запуск контейнера (для того, чтобы появились аутпуты в `output`; заменить директорию на релевантную):**
`docker run --rm -v "C:\Users\smirn\OneDrive\Рабочий стол\mlops_hw1_inference\input:/app/input" -v "C:\Users\smirn\OneDrive\Рабочий стол\mlops_hw1_inference\output:/app/output" mlops_hw1`

## Подробное описание проекта

Сервис подготовлен в демонстрационных целях для студентов курса МТС ШАД 2025 в рамках занятий по MLOps.
Датасеты предоставлены в рамках соревнования https://www.kaggle.com/competitions/teta-ml-1-2025

Сервис для автоматического обнаружения мошеннических транзакций в режиме батчевого скоринга. Обрабатывает CSV-файлы из указанной директории с использованием предобученной CatBoost модели. 

## Архитектура решения
```
├── .gitignore
├── Dockerfile
├── README.md
├── app/
│ └── app.py # Ядро сервиса с обработчиком файлов
├── models/
│ └── my_catboost.cbm # Сериализованная модель CatBoost
├── src/
│ ├── preprocessing.py # Пайплайн обработки данных
│ └── scorer.py # Модуль прогнозирования
└── train_data/
│ └── train.csv # Данные для обучения (reference), необходимо скачать из соревнования (в проекте данные лежат в папке `models`)
└── input/ # Директория для загрузки файлов на скоринг
└── output/ # Директория с результатами скоринга
```

## Ключевые особенности

### Многоуровневое логирование
- Регистрация всех событий в файл `/app/logs/service.log`
- Консольный вывод для мониторинга в реальном времени
- 3 уровня детализации:
  - `INFO`: Основные этапы обработки
  - `DEBUG`: Детали преобразования данных
  - `ERROR`: Критические сбои с трейсбэками

### Пайплайн обработки данных (`preprocessing.py`)

1. **Временные признаки**:
   - Извлечение месяца, недели, дня недели, часа и минуты из времени транзакции
   - Формирование признаков праздничных дней и времени суток

2. **Геопространственные признаки**:
   - Расчет расстояния и угловых направлений между клиентом и мерчантом по координатам (haversine и bearing)

3. **Финансовые и агрегированные признаки**:
   - Логарифмирование суммы транзакции
   - Агрегация ночных и крупных транзакций, расчет перцентилей и сумм за день

4. **Категориальные переменные**:
   - Преобразование категориальных признаков через CatBoost encoding с учетом целевой переменной

### Модельный слой (`scorer.py`)
- Порог классификации: 0.29
- Автоматическая загрузка модели при инициализации
- Батчевая обработка через `predict_proba`

## Быстрый старт

### Требования
- Docker 20.10+
- 2 ГБ свободного места
- Порты: только файловая система
